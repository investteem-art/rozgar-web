<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Work - RozgarSathi</title>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: #f4f7f6; padding-top: 70px; }
        .top-nav { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); padding: 15px; position: fixed; top: 0; width: 100%; z-index: 1000; color: white; display: flex; align-items: center; gap: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .back-btn { text-decoration: none; color: white; font-size: 24px; }
        .container { padding: 15px; max-width: 500px; margin: 0 auto; }
        .search-card { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #475569; }
        select, input { width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 12px; font-size: 15px; outline: none; background: #f8fafc; }
        .confirm-btn { width: 100%; padding: 15px; background: #10b981; color: white; border: none; border-radius: 15px; font-weight: 700; font-size: 16px; cursor: pointer; transition: 0.3s; }
        .confirm-btn:hover { background: #059669; }
        .result-card { background: white; border-radius: 15px; padding: 15px; margin-bottom: 15px; border-left: 5px solid #4facfe; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .actions { display: flex; gap: 10px; margin-top: 10px; }
        .btn { flex: 1; padding: 10px; border-radius: 8px; text-align: center; text-decoration: none; color: white; font-weight: bold; font-size: 13px; }
        .btn-call { background: #10b981; }
        .btn-map { background: #f59e0b; }
    </style>
</head>
<body>

    <div class="top-nav">
        <a href="home.html" class="back-btn">‚Üê</a>
        <h3 style="font-size: 18px;">Search Jobs / Workers</h3>
    </div>

    <div class="container">
        <div class="search-card">
            <div class="form-group">
                <label>üë§ You need?</label>
                <select id="findRole">
                    <option value="all">Everyone</option>
                    <option value="owner">Owner / Contractor</option>
                    <option value="worker">Worker / Labor</option>
                </select>
            </div>
            <div class="form-group">
                <label>üéØ Category</label>
                <select id="findCat">
                    <option value="all">All Categories</option>
                    <option value="plumber">Plumber</option>
                    <option value="mistry">Mistry</option>
                    <option value="electrician">Electrician</option>
                    <option value="driver">Driver</option>
                    <option value="helper">Helper</option>
                    <option value="painter">Painter</option>
                </select>
            </div>
            <div class="form-group">
                <label>üìç Distance (Max km)</label>
                <input type="number" id="findRange" placeholder="e.g. 10" value="50">
            </div>
            <button class="confirm-btn" onclick="startSearch()">üîç Confirm & Search</button>
        </div>

        <div id="searchResults"></div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDQaAXGwPClpui0jxUrIPb5qok-pCAG--4",
            authDomain: "rozgar-sathi-1ae88.firebaseapp.com",
            databaseURL: "https://rozgar-sathi-1ae88-default-rtdb.firebaseio.com",
            projectId: "rozgar-sathi-1ae88",
            appId: "1:78331447702:web:5d932141d7a369091635b7"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function startSearch() {
            const role = document.getElementById('findRole').value;
            const cat = document.getElementById('findCat').value;
            const resultsDiv = document.getElementById('searchResults');
            
            resultsDiv.innerHTML = "<p style='text-align:center;'>Searching...</p>";

            db.ref('jobApplications').once('value', snap => {
                let html = '';
                if (snap.exists()) {
                    snap.forEach(child => {
                        const data = child.val();
                        // Filter Logic
                        const roleMatch = (role === 'all' || data.applicantType === role);
                        const catMatch = (cat === 'all' || data.mainCategory === cat);

                        if (roleMatch && catMatch) {
                            const title = data.mainCategory === 'other' ? data.otherWorkName : data.mainCategory;
                            html += `
                            <div class="result-card" style="border-left-color: ${data.applicantType === 'owner' ? '#f59e0b' : '#10b981'}">
                                <h4 style="text-transform: capitalize;">${title} (${data.applicantType})</h4>
                                <p style="font-size: 13px; color: #666; margin: 5px 0;">üìç ${data.workAddress || 'No Address'}</p>
                                <p style="font-size: 14px; font-weight: bold; color: #10b981;">‚Çπ${data.dailyRate || 0} / Day</p>
                                <div class="actions">
                                    <a href="tel:${data.userPhone}" class="btn btn-call">Call</a>
                                    <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(data.workAddress)}" target="_blank" class="btn btn-map">Map</a>
                                </div>
                            </div>`;
                        }
                    });
                    resultsDiv.innerHTML = html || "<p style='text-align:center;'>No match found.</p>";
                } else {
                    resultsDiv.innerHTML = "<p style='text-align:center;'>No data available.</p>";
                }
            });
        }
    </script>
</body>
</html>
