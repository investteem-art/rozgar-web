<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post Job - RozgarSathi</title>
    <link rel="manifest" href="/manifest.json">
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js');
        }
    </script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh; padding: 20px; }
        .header { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 15px; border-radius: 20px; margin-bottom: 20px; text-align: center; box-shadow: 0 10px 30px rgba(79,172,254,0.4); }
        .container { max-width: 500px; margin: 0 auto; background: white; border-radius: 25px; padding: 25px; box-shadow: 0 20px 60px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #1e293b; }
        input, select, textarea { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 15px; background: #f8fafc; outline: none; }
        
        .sub-box { display: none; margin-top: 10px; }
        .active { display: block; }

        .btn { width: 100%; padding: 15px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-submit { background: #10b981; color: white; font-size: 16px; margin-top: 10px; }
        .btn-loc { width: 60px; background: #3b82f6; color: white; border-radius: 12px; border: none; font-size: 24px; cursor: pointer; }
        .back-btn { background: #6b7280; color: white; margin-bottom: 15px; }
        .hidden { display: none !important; }
        .video-ad-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10000; align-items: center; justify-content: center; }
        .video-ad-modal.active { display: flex; }
    </style>
</head>
<body>

    <div class="header"><h1>ğŸ“‹ Job Application</h1></div>

    <div class="container">
        <button class="btn back-btn" onclick="location.href='home.html'">â† Back to Jobs</button>
        
        <form id="jobForm">
            <div class="form-group">
                <label>ğŸ‘¤ Who are you?</label>
                <select id="applicantType" required>
                    <option value="owner">ğŸ¢ Owner</option>
                    <option value="worker">ğŸ‘· Worker</option>
                </select>
            </div>

            <div class="form-group">
                <label>ğŸ¯ Category</label>
                <select id="mainCategory" onchange="toggleExtraBoxes()" required>
                    <option value="plumber">ğŸš¿ Plumber</option>
                    <option value="mistry">ğŸ‘· Mistry</option>
                    <option value="electrician">âš¡ Electrician</option>
                    <option value="driver">ğŸš— Driver</option>
                    <option value="helper">ğŸ‘· Helper</option>
                    <option value="painter">ğŸ¨ Painter</option>
                    <option value="other">ğŸ’¼ Other</option>
                </select>
            </div>

            <div class="form-group sub-box" id="mistryBox">
                <label>ğŸ”§ Mistry Type</label>
                <select id="subCategory">
                    <option value="tall_pathar">Tall/Pathar</option>
                    <option value="pilastr_chinai">Pilastr/Chinai</option>
                    <option value="arounder">Arounder</option>
                </select>
            </div>

            <div class="form-group sub-box" id="otherBox">
                <label>ğŸ’¼ Work Name</label>
                <input type="text" id="otherWorkName" placeholder="Enter Job name">
            </div>

            <div class="form-group">
                <label>ğŸ’° Daily Rate (â‚¹)</label>
                <input type="number" id="dailyRate" required>
            </div>

            <div class="form-group">
                <label>ğŸ“ Work Location (GPS Only)</label>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="workAddress" placeholder="Click ğŸ“ to get location" readonly required style="background: #e2e8f0;">
                    <button type="button" class="btn-loc" onclick="getLiveLocation()">ğŸ“</button>
                </div>
            </div>

            <div class="form-group">
                <label>ğŸ“ Description</label>
                <textarea id="description" rows="3" required></textarea>
            </div>

            <button type="submit" class="btn btn-submit" id="submitBtn">âœ… Confirm & Submit</button>
        </form>

        <div id="successScreen" class="hidden" style="text-align:center;">
            <h2 style="color:#10b981;">âœ… Published!</h2>
            <button class="btn btn-submit" onclick="location.href='home.html'">Back to Home</button>
        </div>
    </div>

    <div class="video-ad-modal" id="videoAdModal">
        <div style="position:relative; width:90%;">
            <video id="adVideo" style="width:100%; border-radius:15px;" controls>
                <source src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" type="video/mp4">
            </video>
            <button id="skipAdBtn" onclick="skipAd()" style="position:absolute; top:10px; right:10px; padding:10px; background:white; border-radius:20px; font-weight:bold; display:none;">Skip</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDQaAXGwPClpui0jxUrIPb5qok-pCAG--4",
            authDomain: "rozgar-sathi-1ae88.firebaseapp.com",
            databaseURL: "https://rozgar-sathi-1ae88-default-rtdb.firebaseio.com",
            projectId: "rozgar-sathi-1ae88",
            storageBucket: "rozgar-sathi-1ae88.firebasestorage.app",
            messagingSenderId: "78331447702",
            appId: "1:78331447702:web:5d932141d7a369091635b7"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function toggleExtraBoxes() {
            const cat = document.getElementById('mainCategory').value;
            document.getElementById('mistryBox').classList.toggle('active', cat === 'mistry');
            document.getElementById('otherBox').classList.toggle('active', cat === 'other');
        }

        function getLiveLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((pos) => {
                    document.getElementById('workAddress').value = pos.coords.latitude + "," + pos.coords.longitude;
                }, () => alert("Enable GPS"), { enableHighAccuracy: true });
            }
        }

        document.getElementById('jobForm').onsubmit = (e) => { 
            e.preventDefault(); 
            if(!document.getElementById('workAddress').value) return alert("Get location first!");
            document.getElementById('videoAdModal').classList.add('active');
            document.getElementById('adVideo').play();
            setTimeout(() => { document.getElementById('skipAdBtn').style.display = 'block'; }, 5000);
        };

        function skipAd() {
            document.getElementById('videoAdModal').classList.remove('active');
            submitData();
        }

        async function submitData() {
            const btn = document.getElementById('submitBtn');
            const user = firebase.auth().currentUser;
            const data = {
                uid: user.uid,
                applicantType: document.getElementById('applicantType').value,
                mainCategory: document.getElementById('mainCategory').value,
                subCategory: document.getElementById('subCategory').value || null,
                otherWorkName: document.getElementById('otherWorkName').value || null,
                dailyRate: document.getElementById('dailyRate').value,
                workAddress: document.getElementById('workAddress').value,
                description: document.getElementById('description').value,
                userPhone: user.phoneNumber,
                userPhoto: localStorage.getItem('userPhoto') || '',
                timestamp: Date.now()
            };
            try {
                await db.ref('jobApplications').push(data);
                document.getElementById('jobForm').classList.add('hidden');
                document.getElementById('successScreen').classList.remove('hidden');
            } catch(err) { alert(err.message); }
        }
    </script>
</body>
</html>